from django.db import models

from config.abstract import StandardModel


class Comuna(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre')
    codigo = models.CharField(max_length=200, verbose_name='Código de Comuna')
    pais = models.ForeignKey('kardex.Pais', on_delete=models.SET_NULL, null=True, blank=True, verbose_name='País')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'Comuna'
        verbose_name_plural = 'Comunas'
from django.db import models

from config.abstract import StandardModel


class Establecimiento(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre')
    direccion = models.CharField(max_length=200, verbose_name='Dirección')
    telefono = models.CharField(max_length=15, verbose_name='Teléfono')
    comuna = models.ForeignKey('kardex.Comuna', on_delete=models.PROTECT, null=False, verbose_name='Comuna')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'Establecimiento'
        verbose_name_plural = 'Establecimientos'
from django.db import models

from config.abstract import StandardModel


class Ficha(StandardModel):
    numero_ficha = models.IntegerField(verbose_name='Número de Ficha')
    observacion = models.TextField(null=True, blank=True, verbose_name='Observación')
    fecha_creacion = models.DateField(auto_now_add=True, verbose_name='Fecha de Creación')
    fecha_mov = models.DateField(null=True, blank=True, verbose_name='Fecha de Movimiento')

    usuario = models.ForeignKey('usuarios.UsuarioPersonalizado', on_delete=models.PROTECT, null=False,
                                verbose_name='Usuario')
    profesional = models.ForeignKey('kardex.Profesional', on_delete=models.PROTECT, null=False,
                                    verbose_name='Profesional')

    ingreso_paciente = models.ForeignKey('kardex.IngresoPaciente', on_delete=models.PROTECT, null=False,
                                         verbose_name='Paciente')

    def __str__(self):
        return str(self.numero_ficha)

    class Meta:
        verbose_name = 'Ficha'
        verbose_name_plural = 'Fichas'
from django.db import models

from config.abstract import StandardModel


class IngresoPaciente(StandardModel):
    fecha_ingreso = models.DateField(auto_now_add=True, verbose_name='Fecha de Ingreso')
    motivo_ingreso = models.TextField(null=True, blank=True, verbose_name='Motivo de Ingreso')
    diagnostico_ingreso = models.TextField(null=True, blank=True, verbose_name='Diagnóstico de Ingreso')
    estado_actual = models.TextField(null=True, blank=True, verbose_name='Estado Actual')
    fecha_egreso = models.DateField(null=True, blank=True, verbose_name='Fecha de Egreso')

    paciente = models.ForeignKey('kardex.Paciente', on_delete=models.PROTECT, null=False,
                                 verbose_name='Paciente')

    def __str__(self):
        return self.paciente.rut

    class Meta:
        verbose_name = 'Ingreso de Paciente'
        verbose_name_plural = 'Ingresos de Pacientes'
from django.db import models

from config.abstract import StandardModel
from kardex.choices import ESTADO_RESPUESTA


class MovimientoFicha(StandardModel):
    fecha_creacion = models.DateTimeField(auto_now_add=True, verbose_name='Fecha de Creación')
    fecha_mov = models.DateTimeField(verbose_name='Fecha de Movimiento')
    fecha_salida = models.DateTimeField(null=True, blank=True, verbose_name='Fecha de Salida')
    fecha_entrada = models.DateTimeField(null=True, blank=True, verbose_name='Fecha de Entrada')
    observacion_entrada = models.TextField(null=True, blank=True, verbose_name='Observación de Entrada')
    observacion_salida = models.TextField(null=True, blank=True, verbose_name='Observación de Salida')
    usuario_entrega = models.CharField(max_length=100, null=True, blank=True, verbose_name='Usuario que Entrega')
    usuario_entrada = models.CharField(max_length=100, null=True, blank=True, verbose_name='Usuario que Entrada')
    estado_respuesta = models.CharField(max_length=50, choices=ESTADO_RESPUESTA,
                                        default='EN ESPERA', null=False, verbose_name='Estado de Respuesta')

    servicio_clinico = models.ForeignKey('kardex.ServicioClinico', null=False, on_delete=models.PROTECT,
                                         verbose_name='Servicio Clínico')
    ficha = models.ForeignKey('kardex.Ficha', null=True, blank=True, on_delete=models.PROTECT,
                              verbose_name='Ficha')
    usuario = models.ForeignKey('usuarios.UsuarioPersonalizado', null=True, blank=True, on_delete=models.PROTECT,
                                verbose_name='Usuario')

    def __str__(self):
        return f"Movimiento de Ficha #{self.ficha.id if self.ficha else 'N/A'}"

    class Meta:
        verbose_name = 'Movimiento Ficha'
        verbose_name_plural = 'Movimientos Fichas'
from django.db import models

from config.abstract import StandardModel
from kardex.choices import ESTADO_CIVIL


class Paciente(StandardModel):
    rut = models.CharField(max_length=100, unique=True, null=False, verbose_name='Rut')
    nombre = models.CharField(max_length=100, null=False, verbose_name='Nombre')

    apellido_paterno = models.CharField(max_length=100, null=False, verbose_name='Apellido Paterno')
    apellido_materno = models.CharField(max_length=100, null=False, verbose_name='Apellido Materno')
    rut_madre = models.CharField(max_length=100, null=True, blank=True, verbose_name='R.U.T. Madre')
    fecha_nacimiento = models.DateField(null=False, verbose_name='Fecha de Nacimiento')
    sexo = models.CharField(max_length=10, choices=[('MASCULINO', 'Masculino'), ('FEMENINO', 'Femenino')], null=False,
                            verbose_name='Sexo')
    estado_civil = models.CharField(max_length=20, choices=ESTADO_CIVIL, null=False, verbose_name='Estado Civil')

    nombres_padre = models.CharField(max_length=100, verbose_name='Nombres del Padre', null=True, blank=True)
    nombres_madre = models.CharField(max_length=100, verbose_name='Nombres de la Madre', null=True, blank=True)
    nombre_pareja = models.CharField(max_length=100, verbose_name='Nombre de la Pareja', null=True, blank=True)

    direccion = models.CharField(max_length=200, verbose_name='Dirección', null=False)
    numero_telefono1 = models.CharField(max_length=15, verbose_name='Número de Teléfono', null=True)
    numero_telefono2 = models.CharField(max_length=15, verbose_name='Número de Teléfono 2', null=True, blank=True)
    fecha_movimiento = models.DateField(auto_now=True, verbose_name='Fecha de Movimiento')
    pasaporte = models.CharField(max_length=50, unique=True, null=True, blank=True, verbose_name='Pasaporte')

    recien_nacido = models.BooleanField(default=False, verbose_name='Recién Nacido')
    extranjero = models.BooleanField(default=False, verbose_name='Extranjero')
    fallecido = models.BooleanField(default=False, verbose_name='Fallecido')
    fecha_fallecimiento = models.DateField(null=True, blank=True, verbose_name='Fecha de Fallecimiento')

    ocupacion = models.CharField(max_length=100, null=True, blank=True, verbose_name='Ocupación')
    representante_legal = models.CharField(max_length=100, null=True, blank=True, verbose_name='Representante Legal')
    nombre_social = models.CharField(max_length=100, null=True, blank=True, verbose_name='Nombre Social')

    comuna = models.ForeignKey('kardex.Comuna', on_delete=models.PROTECT, null=False,
                               verbose_name='Comuna')
    prevision = models.ForeignKey('kardex.Prevision', on_delete=models.SET_NULL, null=True, blank=True,
                                  verbose_name='Previsión')

    usuario = models.ForeignKey('usuarios.UsuarioPersonalizado', on_delete=models.SET_NULL, null=True, blank=True,
                                verbose_name='Usuario')

    def __str__(self):
        return self.rut

    class Meta:
        verbose_name = 'Paciente'
        verbose_name_plural = 'Pacientes'
from django.db import models

from config.abstract import StandardModel


class Pais(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre del País')
    cod_pais = models.CharField(max_length=10, unique=True, null=False, verbose_name='Código del País')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'País'
        verbose_name_plural = 'Países'
from django.db import models

from config.abstract import StandardModel


class Prevision(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'Prevision'
        verbose_name_plural = 'Previsiones'
from django.db import models

from config.abstract import StandardModel


class Profesion(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'Profesion'
        verbose_name_plural = 'Profesiones'
from django.db import models

from config.abstract import StandardModel


class Profesional(StandardModel):
    rut = models.CharField(max_length=100, unique=True, null=False, verbose_name='R.U.T.')
    nombres = models.CharField(max_length=100, null=False, verbose_name='Nombre')
    correo = models.EmailField(max_length=100, unique=True, null=False, verbose_name='Correo')
    telefono = models.CharField(max_length=15, verbose_name='Teléfono')
    profesion = models.ForeignKey('kardex.Profesion', null=True, blank=True, on_delete=models.SET_NULL,
                                  verbose_name='Profesión')

    establecimiento = models.ForeignKey('kardex.Establecimiento', null=True, blank=True, on_delete=models.SET_NULL,
                                        verbose_name='Establecimiento')

    def __str__(self):
        return self.nombres

    class Meta:
        verbose_name = 'Profesional'
        verbose_name_plural = 'Profesionales'
from django.db import models

from config.abstract import StandardModel


class ServicioClinico(StandardModel):
    nombre = models.CharField(max_length=100, unique=True, null=False, verbose_name='Nombre')
    tiempo_horas = models.IntegerField(null=False, verbose_name='Tiempo en horas')
    correo_jefe = models.EmailField(max_length=100, unique=True, null=False, verbose_name='Correo del jefe a cargo')
    telefono = models.CharField(max_length=15, verbose_name='Teléfono')

    establecimiento = models.ForeignKey('kardex.Establecimiento', null=True, blank=True, on_delete=models.SET_NULL,
                                        verbose_name='Establecimiento')

    def __str__(self):
        return self.nombre

    class Meta:
        verbose_name = 'Servicio Clínico'
        verbose_name_plural = 'Servicios Clínicos'
