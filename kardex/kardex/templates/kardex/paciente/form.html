{% extends 'base.html' %}
{% load static %}

{% block title %}Pacientes - {{ title|default:'Formulario' }}{% endblock %}

{% block content %}
<form method="post" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}
    <input type="hidden" name="action" value="{{ action|default:'add' }}">

    <!-- SECCIÓN 0: Condiciones -->
    <div class="card card-warning">
        <div class="card-header">
            <h3 class="card-title">Condiciones</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                {% for field in form %}
                {% if field.name in "recien_nacido extranjero fallecido" %}
                <div class="form-group col-md-4">
                    <div class="form-check">
                        {{ field }}
                        {{ field.label_tag }}
                        {% for error in field.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}

                <div class="form-group col-md-6">
                    {{ form.fecha_fallecimiento.label_tag }}
                    {{ form.fecha_fallecimiento }}
                    {% for error in form.fecha_fallecimiento.errors %}
                    <span class="text-danger small">{{ error }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN 1: Datos Personales -->
    <div class="card card-primary">
        <div class="card-header">
            <h3 class="card-title">Datos Personales</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                {% for field in form %}
                {% if field.name in "rut pasaporte nombre nombre_social apellido_paterno apellido_materno fecha_nacimiento sexo estado_civil" %}
                <div class="form-group col-md-6">
                    {{ field.label_tag }}
                    {{ field }}
                    {% for error in field.errors %}
                    <span class="text-danger small">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- SECCIÓN 2: Información Familiar -->
    <div class="card card-info">
        <div class="card-header">
            <h3 class="card-title">Información Familiar</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                {% for field in form %}
                {% if field.name in "rut_madre nombres_madre nombres_padre nombre_pareja representante_legal" %}
                <div class="form-group col-md-6">
                    {{ field.label_tag }}
                    {{ field }}
                    {% for error in field.errors %}
                    <span class="text-danger small">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- SECCIÓN 3: Contacto y Ubicación -->
    <div class="card card-success">
        <div class="card-header">
            <h3 class="card-title">Contacto y Ubicación</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                {% for field in form %}
                {% if field.name in "direccion comuna numero_telefono1 numero_telefono2" %}
                <div class="form-group col-md-6">
                    {{ field.label_tag }}
                    {{ field }}
                    {% for error in field.errors %}
                    <span class="text-danger small">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- SECCIÓN 4: Información Adicional -->
    <div class="card card-warning">
        <div class="card-header">
            <h3 class="card-title">Información Adicional</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                {% for field in form %}
                {% if field.name in "prevision ocupacion fecha_movimiento" %}
                <div class="form-group col-md-6">
                    {{ field.label_tag }}
                    {{ field }}
                    {% for error in field.errors %}
                    <span class="text-danger small">{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>



    <!-- BOTONES -->
    <div class="d-flex justify-content-end gap-2 mt-4">
        <a href="{% url 'kardex:paciente_list' %}" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar</button>
    </div>

</form>
{% endblock %}
