{% extends 'base.html' %}
{% load static %}

{% block title %}Actualización Paciente{% endblock %}
{% block content %}

<div class="container-fluid py-2 small-input">
    <form method="post" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <!-- Encabezado de la ficha -->
        <div class="row align-items-center mb-2">
            <div class="col-md-6 mb-2 mb-md-0">
                <div class="ficha-header align-items-center">
                    <div class="row">
                        <div class="col-7">
                            <span>N° FICHA:</span><br>
                            <input name="ficha" class="form-control" placeholder="N° Ficha" id="id_ficha"
                                   style="min-width: 100px;" value="{{ ficha_numero|default:'' }}" disabled/>
                        </div>
                        <div class="col-4">
                            <div class="text-muted small">
                                <div>
                                    F. creación: <span
                                        id="ficha_created_at_text">{{ ficha_created_at_text|default:'' }}</span><br>
                                    F. modificación: <span id="ficha_updated_at_text">{{ ficha_updated_at_text|default:'' }}</span>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 text-md-end ficha-header">
                <span>N° Código:</span><br>
                <input name="codigo" class="form-control"
                       placeholder="Código" id="id_codigo" value="{{ paciente_codigo|default:'' }}" disabled/>
                <input type="hidden" id="codigo_inicial" value="{{ paciente_codigo|default:'' }}">
            </div>

            <div class="col-md-3 text-md-end">
                <div class="btn-group w-100 no-print" role="group" aria-label="Impresión y Acciones">
                    {% if ficha %}
                    <a id="btn-caratula" class="btn btn-outline-secondary btn-sm w-50" href="{{ caratula_url }}"
                       target="_blank"
                       rel="noopener noreferrer">Carátula</a>
                    <a id="btn-stickers" class="btn btn-outline-secondary btn-sm w-50" href="{{ stickers_url }}"
                       target="_blank"
                       rel="noopener noreferrer">Stickers</a>
                    {% else %}
                    <a id="btn-caratula" class="btn btn-outline-secondary btn-sm w-50 disabled" href="#" target="_blank"
                       aria-disabled="true" rel="noopener noreferrer">Carátula</a>
                    <a id="btn-stickers" class="btn btn-outline-secondary btn-sm w-50 disabled" href="#" target="_blank"
                       aria-disabled="true" rel="noopener noreferrer">Stickers</a>
                    {% endif %}
                </div>
            </div>


        </div>

        <!-- ESTADO DEL PACIENTE -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-heartbeat me-2"></i> Estado del Paciente</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <!-- Checkbox 1 -->
                    <div class="col-md-3">
                        <div class="form-check mt-2">
                            {{ form.recien_nacido }}
                            <label class="form-check-label" for="recien_nacido_paciente">
                                {{ form.recien_nacido.label }}
                            </label>
                            {% for error in form.recien_nacido.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Checkbox 2 -->
                    <div class="col-md-3">
                        <div class="form-check mt-2">
                            {{ form.extranjero }}
                            <label class="form-check-label" for="extranjero_paciente">
                                {{ form.extranjero.label }}
                            </label>
                            {% for error in form.extranjero.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Checkbox 2 -->
                    <div class="col-md-3">
                        <div class="form-check mt-2">
                            {{ form.pueblo_indigena }}
                            <label class="form-check-label" for="pueblo_indigena_paciente">
                                {{ form.pueblo_indigena.label }}
                            </label>
                            {% for error in form.pueblo_indigena.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Checkbox 3 + input date -->
                    <div class="col-md-3">
                        <div class="form-check mt-2">
                            {{ form.fallecido }}
                            <label class="form-check-label" for="fallecido_paciente">
                                {{ form.fallecido.label }}
                            </label>
                            {% for error in form.fallecido.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <!-- Input de fecha debajo del checkbox fallecido -->
                        <div class="mt-2">
                            <label class="form-label" for="fecha_fallecimiento_paciente">
                                {{ form.fecha_fallecimiento.label }}
                            </label>
                            {{ form.fecha_fallecimiento }}
                            {% for error in form.fecha_fallecimiento.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- IDENTIFICACIÓN -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-id-card me-2"></i> Identificación</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="form-label" for="id_rut">
                            {{ form.rut.label }}
                        </label>
                        {{ form.rut }}
                        <!--  Primera consulta con Edición-->
                        <input type="hidden" id="rut_inicial" value="{{ paciente.rut|default:'' }}">
                        {% for error in form.rut.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="pasaporte_paciente">
                            {{ form.pasaporte.label }}
                        </label>
                        {{ form.pasaporte }}
                        {% for error in form.pasaporte.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nip_paciente">
                            {{ form.nip.label }}
                        </label>
                        {{ form.nip }}
                        {% for error in form.nip.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nombre_paciente">
                            {{ form.nombre.label }}
                        </label>
                        {{ form.nombre }}
                        {% for error in form.nombre.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="apellido_paterno_paciente">
                            {{ form.apellido_paterno.label }}
                        </label>
                        {{ form.apellido_paterno }}
                        {% for error in form.apellido_paterno.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="apellido_materno_paciente">
                            {{ form.apellido_materno.label }}
                        </label>
                        {{ form.apellido_materno }}
                        {% for error in form.apellido_materno.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nombre_social_paciente">
                            {{ form.nombre_social.label }}
                        </label>
                        {{ form.nombre_social }}
                        {% for error in form.nombre_social.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- DATOS DE NACIMIENTO -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-baby me-2"></i> Datos de Nacimiento</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-3">
                        <label class="form-label" for="fecha_nacimiento_paciente">
                            {{ form.fecha_nacimiento.label }}</label>
                        {{ form.fecha_nacimiento }}
                        {% for error in form.fecha_nacimiento.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="sexo_paciente">{{ form.sexo.label }}</label>
                        {{ form.sexo }}
                        {% for error in form.sexo.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="estado_civil_paciente">{{ form.estado_civil.label }}</label>
                        {{ form.estado_civil }}
                        {% for error in form.estado_civil.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="genero">{{ form.genero.label }}</label>
                        {{ form.genero }}
                        {% for error in form.genero.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- DATOS FAMILIARES -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-users me-2"></i> Datos Familiares</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="form-label" for="id_rut">{{ form.rut_madre.label }}</label>
                        {{ form.rut_madre }}
                        {% for error in form.rut_madre.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nombres_madre_paciente">{{ form.nombres_madre.label }}</label>
                        {{ form.nombres_madre }}
                        {% for error in form.nombres_madre.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nombres_padre_paciente">{{ form.nombres_padre.label }}</label>
                        {{ form.nombres_padre }}
                        {% for error in form.nombres_padre.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="nombre_pareja_paciente">{{ form.nombre_pareja.label }}</label>
                        {{ form.nombre_pareja }}
                        {% for error in form.nombre_pareja.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="rut_responsable_temporal_paciente">
                            {{ form.rut_responsable_temporal.label }}
                        </label>
                        {{ form.rut_responsable_temporal }}
                        {% for error in form.rut_responsable_temporal.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <div class="form-check mt-2">
                            {{ form.usar_rut_madre_como_responsable }}
                            <label class="form-check-label" for="usar_rut_madre_como_responsable_paciente">
                                {{ form.usar_rut_madre_como_responsable.label }}
                            </label>
                            {% for error in form.usar_rut_madre_como_responsable.errors %}
                            <span class="text-danger small d-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="representante_legal_paciente">
                            {{ form.representante_legal.label }}
                        </label>
                        {{ form.representante_legal }}
                        {% for error in form.representante_legal.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTACTO Y DIRECCIÓN -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-map-marker-alt me-2"></i> Contacto y Dirección</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-8">
                        <label class="form-label" for="direccion_paciente">{{ form.direccion.label }}</label>
                        {{ form.direccion }}
                        {% for error in form.direccion.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="comuna_paciente">{{ form.comuna.label }}</label>
                        {{ form.comuna }}
                        {% for error in form.comuna.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        {{ form.sin_telefono }}
                        <label class="form-label" for="sin_telefono_paciente">
                            {{ form.sin_telefono.label }}
                        </label>
                        {% for error in form.sin_telefono.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="numero_telefono1_paciente">
                            {{ form.numero_telefono1.label }}</label>
                        {{ form.numero_telefono1 }}
                        {% for error in form.numero_telefono1.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="numero_telefono2_paciente">
                            {{ form.numero_telefono2.label }}</label>
                        {{ form.numero_telefono2 }}
                        {% for error in form.numero_telefono2.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="ocupacion_paciente">{{ form.ocupacion.label }}</label>
                        {{ form.ocupacion }}
                        {% for error in form.ocupacion.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-12">
                        <label class="form-label" for="alergico_a_paciente">{{ form.alergico_a.label }}</label>
                        {{ form.alergico_a }}
                        {% for error in form.alergico_a.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- GESTIÓN -->
        <div class="card mb-2">
            <div class="card-header">
                <h6 class="m-0"><i class="fas fa-cogs me-2"></i> Gestión</h6>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-3">
                        <label class="form-label" for="prevision_paciente">{{ form.prevision.label }}</label>
                        {{ form.prevision }}
                        {% for error in form.prevision.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="sector_paciente">{{ form.sector.label }}</label>
                        {{ form.sector }}
                        {% for error in form.sector.errors %}
                        <span class="text-danger small">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="paciente_pasivar">Pasivar</label>
                        {% if ficha %}
                        <a id="btn-pasivar-gestion"
                           class="btn {% if ficha_pasivado %}btn-danger{% else %}btn-info{% endif %} form-control"
                           href="{{ pasivar_url }}"
                           rel="noopener noreferrer">{% if ficha_pasivado %}Despasivar{% else %}Pasivar{% endif %}</a>
                        {% else %}
                        <a id="btn-pasivar-gestion" class="btn btn-info form-control disabled" href="#"
                           aria-disabled="true" rel="noopener noreferrer">Pasivar</a>
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="paciente_pasivar">Asignar N° Ficha de Tarjeta</label>
                        {% if ficha %}
                        <a id="btn-ficha-tarjeta" class="btn btn-warning form-control" href="{{ ficha_tarjeta_url }}">Ficha
                            en Tarjeta</a>
                        {% else %}
                        <a id="btn-ficha-tarjeta" class="btn btn-warning form-control disabled" href="#"
                           aria-disabled="true">Ficha en Tarjeta</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie del formulario -->
        <div class="row mt-3 mb-4">
            <div class="col text-end">

                <a href="{% url 'kardex:paciente_list' %}" class="btn btn-secondary btn-sm no-print">Cancelar</a>
                <button type="submit" class="btn btn-primary btn-sm no-print">Guardar</button>
            </div>
        </div>
    </form>
</div>


{% endblock %}

{% block javascript %}
<script>
    $('.select2').select2({
        theme: 'bootstrap4',
        width: '100%'
    });
</script>
<script src="{% static 'js/fields_form_paciente.js' %}"></script>

{% endblock %}