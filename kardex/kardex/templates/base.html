{% load static %}

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Kardex App{% endblock %}</title>

    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
        rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'adminlte3/plugins/fontawesome-free/css/all.min.css' %}" />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{% static 'adminlte3/plugins/bootstrap/css/bootstrap.min.css' %}" />

    <!-- DataTables -->
    <link rel="stylesheet"
        href="{% static 'adminlte3/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}" />
    <link rel="stylesheet"
        href="{% static 'adminlte3/plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}" />
    <link rel="stylesheet"
        href="{% static 'adminlte3/plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}" />

    <!-- Select2 -->
    <link rel="stylesheet" href="{% static 'adminlte3/plugins/select2/css/select2.min.css' %}" />
    <link rel="stylesheet"
        href="{% static 'adminlte3/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}" />

    <!-- SweetAlert2 -->
    <link rel="stylesheet"
        href="{% static 'adminlte3/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}" />

    <!-- InputMask -->
    <link rel="stylesheet" href="{% static 'adminlte3/plugins/inputmask/jquery.inputmask.min.css' %}" />

    <!-- AdminLTE -->
    <link rel="stylesheet" href="{% static 'adminlte3/css/adminlte.min.css' %}" />
    {{ form.media.css }}
</head>
<style>
    #Table {
    font-size: 14px;
}

</style>

<body class="hold-transition layout-top-nav">
    <div class="wrapper">
        {% include 'components/banner.html' %}
        {% include 'components/navbar.html' %}

        <div class="content-wrapper">
            <div class="content-header">
                <div class="container">
                    {% include 'components/messages/messages.html' %}
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1 class="m-0">{{ title }}</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                home
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="container">
                    {% block content %}{% endblock %}
                </div>
            </div>
        </div>



        {% include 'components/footer.html' %}
    </div>

    <!-- Generic Modal for read-only details -->
    <div class="modal fade" id="genericModal" tabindex="-1" role="dialog" aria-labelledby="genericModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="genericModalLabel">Detalle</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="text-center p-4">Cargando...</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- REQUIRED SCRIPTS -->

    <!-- jQuery -->
    <script src="{% static 'adminlte3/plugins/jquery/jquery.min.js' %}"></script>
    <!-- Bootstrap 4 -->
    <script src="{% static 'adminlte3/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <!-- DataTables core -->
    <script src="{% static 'adminlte3/plugins/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
    <!-- DataTables Buttons -->
    <script src="{% static 'adminlte3/plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
    <!-- Dependencias para exportar botones -->
    <script src="{% static 'adminlte3/plugins/jszip/jszip.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/pdfmake/pdfmake.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/pdfmake/vfs_fonts.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
    <script src="{% static 'adminlte3/plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>

    <!-- Select2 -->
    <script src="{% static 'adminlte3/plugins/select2/js/select2.min.js' %}"></script>
    <!-- SweetAlert2 -->
    <script src="{% static 'adminlte3/plugins/sweetalert2/sweetalert2.min.js' %}"></script>
    <!-- InputMask -->
    <script src="{% static 'adminlte3/plugins/inputmask/jquery.inputmask.min.js' %}"></script>
    <!-- AdminLTE App -->
    <script src="{% static 'adminlte3/js/adminlte.min.js' %}"></script>

    <script src="{% static 'js/edit_modal.js' %}"></script>
    <script src="{% static 'js/bootstrap_validate.js' %}" ></script>

    {{ form.media.js }}

<!--    SCRIPT PARA INICIALIZAR CON AJAX DATATABLE-->
    <script>
    $(function () {
        {% if datatable_enabled %}
        const tableEl = $("#Table");
        if (tableEl.length) {
            const table = tableEl.DataTable({
                processing: true,
                serverSide: true,
                responsive: true,
                lengthChange: true,
                autoWidth: false,
                pageLength: 10,
                order: {{ datatable_order|default:"[[0, 'asc']]"|safe }},
                ajax: {
                    url: window.location.href,
                    data: {
                        datatable: 1  // Flag que tu vista ya reconoce
                    }
                },
                buttons: ["copy", "csv", "excel", "pdf", "print", "colvis"],
                language: {
                    url: "{% static 'adminlte3/plugins/datatables/es-ES.json' %}"
                },
                columns: [
                    { data: 'ID' },  // Primer campo: ID
                    { data: 'actions', orderable: false, searchable: false },  // Botones
                    {% for col in columns %}
                        {% if col != 'ID' %}
                            { data: '{{ col }}' },
                        {% endif %}
                    {% endfor %}
                ],
            });

            table.buttons().container().appendTo('#Table_wrapper .col-md-6:eq(0)');
        }
        {% endif %}
    });
    </script>

<!--    INICIALIZAR SELECT2 CON CLASE SELECT2-->
    <script>
      $(document).ready(function () {
        $('.select2').select2({
            theme: 'bootstrap4',
            width: '100%'
        });
      });
    </script>


<!--    SCRIPT DE RUT PARA INPUTMASK-->
    <script>
      $(document).ready(function() {
        const $rut = $('.id_rut');
        if ($rut.length && typeof $rut.inputmask === 'function') {
          $rut.inputmask({
            mask: '9{1,2}.999.999-@',
            definitions: {
              '@': { validator: '[0-9Kk]' }
            },
            showMaskOnHover: false,
            showMaskOnFocus: true,
            clearIncomplete: false
          });
        }
      });
    </script>

<!--    SCRIPT DE TELEFONO PERSONAL CON INPUTMASK-->
    <script>
      $(document).ready(function () {
        $('#telefono_personal').inputmask({
          mask: "+56 9 9999 9999",
          placeholder: "_",
          showMaskOnHover: false,
          showMaskOnFocus: true,
          clearIncomplete: true
        });
      });
    </script>

<!-- SCRIPT DE TELEFONO FIJO CON INPUTMASK -->
    <script>
        $('#telefono_establecimiento').inputmask({
          mask: "+56 99 999 9999",  // Acepta cualquier red fija con código de área 2 dígitos
          definitions: {
            '9': {
              validator: "[0-9]",
              cardinality: 1
            }
          },
          placeholder: "_",
          showMaskOnHover: false,
          showMaskOnFocus: true,
          clearIncomplete: true
        });

    </script>


<!--    SCRIPT PARA VER DETALLES DE UN REGISTRO, ES UN MODAL-->
    <script>
      // Delegated handler for detail view buttons
      $(document).on('click', '.view-btn', function(e) {
        e.preventDefault();
        const url = $(this).attr('href');
        const $modal = $('#genericModal');
        $modal.find('.modal-body').html('<div class="text-center p-4">Cargando...</div>');
        $modal.modal('show');
        $.ajax({
          url: url,
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        }).done(function(html) {
          $modal.find('.modal-body').html(html);
        }).fail(function() {
          $modal.find('.modal-body').html('<div class="alert alert-danger">No se pudo cargar el detalle.</div>');
        });
      });
    </script>

</body>
</html>
